const ui={content:document.getElementById("content"),response:document.getElementById("uiResponse"),batteryLevel:document.getElementById("uiBatteryLevel"),batteryVoltage:document.getElementById("uiBatteryVoltage"),wifiSignal:document.getElementById("uiWiFiSignal"),wifiSignalLabel:document.getElementById("uiWiFiSignalLabel")};function updateTime(){const el=document.getElementById("currentTime");if(el){let now=new Date,timeString=now.getHours().toString().padStart(2,"0")+":"+now.getMinutes().toString().padStart(2,"0")+":"+now.getSeconds().toString().padStart(2,"0");el.innerText=timeString}}function randomisedValue(min,max,rangeExpansion){const extra=(max-min)*rangeExpansion,low=min-extra,high=max+extra;return Math.random()*(high-low)+low}function startAutoRefresh(){updateBatteryInformation(),updateWiFiInformation(),updateTime(),"undefined"!=typeof IntervalManager&&(IntervalManager.add((()=>{updateBatteryInformation(),updateWiFiInformation()}),1e4),IntervalManager.add((()=>{updateTime()}),1e3))}function showResponseError(message="Please check controller is powered on and successfully connected to your WiFi network"){ui.response.innerHTML='<span style="color: red;"><strong>Error</strong> - '+message+"</span>"}function showResponse(message){ui.response.innerHTML='<span style="color: green;">'+message+"</span>"}function clearResponse(){ui.response.innerHTML=""}const mapValue=(x,inMin,inMax,outMin,outMax)=>{const y=outMin+(x-inMin)/(inMax-inMin)*(outMax-outMin);return Math.max(Math.min(outMin,outMax),Math.min(Math.max(outMin,outMax),y))},clamp=(value,a,b)=>Math.max(Math.min(a,b),Math.min(Math.max(a,b),value));function setGauge(gauge,min,max,value,unit,icon,empty){const fillElem=gauge.querySelector(".gauge-fill"),valueElem=gauge.querySelector(".gauge-text .value"),unitElem=gauge.querySelector(".gauge-text .unit"),warningElem=gauge.querySelector(".gauge-warning"),clampedValue=clamp(value,min,max);let pct=mapValue(clampedValue,min,max,0,100);pct<1?pct=1:pct>100&&(pct=100),warningElem.textContent=pct<5?empty:icon,fillElem.style.setProperty("--fill-pct",pct),valueElem.textContent=value.toFixed(1),unitElem.textContent=unit}function updateBatteryInformation(){fetch("/json/battery_info").then((response=>{if(!response.ok)throw new Error(`HTTP ${response.status}: ${response.statusText}`);return response.json()})).then((data=>{let batteryVoltage=data.BatteryVoltage,batteryLevel=data.BatteryLevel;setGauge(ui.batteryVoltage,3.3,4.2,batteryVoltage,"v","‚ö°","Empty"),setGauge(ui.batteryLevel,0,100,batteryLevel,"%","üîã","Empty")})).catch((error=>{console.error("Error fetching battery information: ",error),showResponseError("Unable to get battery information."),setGauge(ui.batteryVoltage,3.3,4.2,0,"v","‚ö°","‚ùì"),setGauge(ui.batteryLevel,0,100,0,"%","üîã","‚ùì")}))}function updateWiFiInformation(){fetch("/json/wifi_status").then((response=>{if(!response.ok)throw new Error(`HTTP ${response.status}: ${response.statusText}`);return response.json()})).then((data=>{setGauge(ui.wifiSignal,-30,-90,data.RSSI,"dBm","üóº","‚ò†Ô∏è"),ui.wifiSignalLabel.textContent=data.Status})).catch((error=>{console.error("Error fetching WiFi Signal Level: ",error),showResponseError("Unable to get WiFi Signal Level."),ui.wifiSignalLabel.textContent="WiFi Signal",setGauge(ui.wifiSignal,-30,-90,-30,"dBm","üóº","‚ò†Ô∏è")}))}startAutoRefresh();