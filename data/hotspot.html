<html lang="en">

<head>
    <title>GamePad</title>
    <link rel='stylesheet' type='text/css' href='default.css' />

    <script>
        var animationFrameId = 0;

        function LoadContent(url, colour, js) {
            document.documentElement.style.setProperty('--bg-color', colour || '#12354dDD');
            var content = document.getElementById('content');
            content.innerHTML = "<p>Loading...</p>";

            fetch(url)
                .then(response => {
                    if (!response.ok) { throw new Error('Network response was not ok'); }

                    // Clear out any existing timers
                    IntervalManager.clearAll();

                    return response.text();
                })
                .then(html => {
                    content.innerHTML = html;

                    if (js !== null) {
                        const script = document.createElement("script");
                        script.src = js;
                        content.appendChild(script);
                    }
                })
                .catch(() => {
                    content.innerHTML = "<p class='warning'>Sorry, unable to communicate with GamePad to load page. It may be turned off, not connected, lost connection or not have its WiFi and Web Service turned on.</p>";
                });
        }

        const IntervalManager = (() => {
            const ids = [];

            return {
                add(fn, delay) {
                    const id = setInterval(fn, delay);
                    ids.push(id);
                    return id;
                },
                clearAll() {
                    ids.forEach(clearInterval);
                    ids.length = 0;
                }
            };
        })();

        const ResizeManager = (() => {
            let resizeHandler = null;

            return {
                attach(fn) {
                    if (resizeHandler) window.removeEventListener('resize', resizeHandler);
                    resizeHandler = fn;
                    window.addEventListener('resize', resizeHandler);
                },
                detach() {
                    if (resizeHandler) {
                        window.removeEventListener('resize', resizeHandler);
                        resizeHandler = null;
                    }
                },
                isAttached() {
                    return !!resizeHandler;
                }
            };
        })();

    </script>
</head>

<body>
    <div class="root">
        <header id="header" class='header'>
            <h1>GamePad Web Service</h1>
            <h2>Hotspot Mode for Device Configuration</h2>
        </header>

        <div id='content' class='content'>
            <h2>Device Information</h2>
            Core: {BuildVersion}<br />
            Controller type: {ControllerType} <br />
            Model number: {ModelNumber} <br />
            Firmware version: v{FirmwareRevision}, Hardware version: v{HardwareRevision} , Software version:
            v{SoftwareRevision}

            <hr />

            <h1>WiFi Configuration</h1>
            <p>The device is currently in WiFi Configuration Mode.
                This is here to allow you to specify a WiFi network for the controller to connect to.</p>
            <p>Any changes made are saved against the currently selected profile on the controller.
                e.g. If you change profile on the device while in WiFi Configuration Mode,
                the WiFi details will be saved against the newly selected profile.</p>
            <p>Once this device has been configured and is connected to a WiFi network,
                you can then reboot the device and it should connect to the specified WiFi network.</p>
            <p>Be aware that some WiFi setups have issues if no password is set due to security.
                If you are using an open WiFi network (no password), and the device has trouble connecting,
                try setting a password on the WiFi network to see if that resolves the issue.</p>

            <hr />

            <h1>WiFi Details for profile - '{ProfileDescription}' </h1>
            <p>Please enter your WiFi name/SSID and password below. WiFi password is case sensitive.</p>

            <form class="form-grid">
                <div class="form-row">
                    <label for="ssid">WiFi Name</label>
                    <input type="text" id="ssid" name="ssid" list="ssidList" value="">
                    <datalist id="ssidList"></datalist>
                </div>

                <div class="form-row">
                    <label for="password">WiFi Password</label>
                    <div class="form-cell">
                        <input type="password" id="password" name="password" value="">
                        <div class="checkbox-inline align-right">
                            <input type="checkbox"
                                onclick="var p=document.getElementById('password');p.type=(p.type==='password')?'text':'password';">
                            <span>Show password</span>
                        </div>
                    </div>
                </div>

                <div class="form-row">
                    <label></label>
                    <input type="submit" value="Save">
                </div>
            </form>


            <div id='formResponse'></div>

            <p>Status of controller testing your saved WiFi name and Password: <span id='wifiStatus'>Fetching
                    status...</span>
            </p>
        </div>

        <footer class='footer'>
            <p><i>(c) 2025-2026 MisterB @ I The P</i></p>
        </footer>
    </div>

    <script src='hotspot.js'></script>
</body>

</html>