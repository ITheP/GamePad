function refreshUIReferences(){ui={content:document.getElementById("content"),form:document.getElementById("uiForm"),ssid:document.getElementById("uiSSID"),password:document.getElementById("uiPassword"),response:document.getElementById("uiResponse"),wifiStatus:document.getElementById("uiWiFiStatus"),ssidList:document.getElementById("ssidList")}}const IntervalManager=(()=>{const ids=[];return{add(fn,delay){const id=setInterval(fn,delay);return ids.push(id),id},clearAll(){ids.forEach(clearInterval),ids.length=0}}})();function togglePasswordVisibility(){const p=ui.password;p.type="password"===p.type?"text":"password"}function showResponseError(message="Unable to communicate with controller. Please check it is currently in Hotspot mode and you are connected to its WiFi access point."){ui.response.innerHTML='<span style="color: red;"><strong>Error</strong> - '+message+'<br/><button onclick="location.reload()">Refresh</button></span>'}function loadHotspotContent(){fetch("/json/hotspot_info").then((response=>{if(!response.ok)throw new Error(`HTTP ${response.status}: ${response.statusText}`);return response.json()})).then((data=>{ui.ssid&&void 0!==data.WiFiSSID&&(ui.ssid.value=data.WiFiSSID),ui.password&&void 0!==data.WiFiPassword&&(ui.password.value=data.WiFiPassword)})).catch((error=>{console.error("Error fetching hotspot info:",error),showResponseError()}))}function updateAccessPoints(){fetch("/json/access_points").then((response=>{if(!response.ok)throw new Error(`HTTP ${response.status}: ${response.statusText}`);return response.json()})).then((data=>{const datalist=ui.ssidList;ui.ssidList.innerHTML="",data.accessPoints&&Array.isArray(data.accessPoints)&&data.accessPoints.forEach((ap=>{const option=document.createElement("option");option.value=ap.SSID,datalist.appendChild(option)}))})).catch((error=>{console.error("Error fetching access points:",error),showResponseError()}))}function updateWiFiStatus(){fetch("/json/wifi_status").then((response=>{if(!response.ok)throw new Error(`HTTP ${response.status}: ${response.statusText}`);return response.json()})).then((data=>{data.Status&&(ui.wifiStatus.textContent=data.Status)})).catch((error=>{console.error("Error fetching wifi status:",error),ui.wifiStatus.innerHTML='<span style="color: red;"><strong>Unable to fetch status.</strong></span>',showResponseError()}))}function handleWiFiFormSubmit(event){event.preventDefault();const form=document.getElementById("wifiForm"),formData=new FormData(form);fetch("/api/UpdateWifiDetails",{method:"POST",body:formData}).then((response=>{if(!response.ok)throw new Error(`HTTP ${response.status}: ${response.statusText}`);return response.json()})).then((data=>{let message="";message=data.error?'<p style="color: red;"><strong>Error:</strong> '+escapeHtml(data.error)+"</p>":"ok"===data.status?'<p style="color: green;"><strong>Success:</strong> WiFi details saved</p>':'<p style="color: orange;"><strong>Response:</strong> '+escapeHtml(JSON.stringify(data))+"</p>",responseDiv.innerHTML=message})).catch((error=>{console.error("Error updating WiFi details: ",error),showResponseError(escapeHtml(error.message))}))}const escapeMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};function escapeHtml(text){return text.replace(/[&<>"']/g,(m=>escapeMap[m]))}function startConfigAutoRefresh(){refreshUIReferences(),loadHotspotContent(),updateAccessPoints(),updateWiFiStatus(),IntervalManager.add((()=>{updateAccessPoints(),updateWiFiStatus()}),1e4),ui.form&&ui.form.addEventListener("submit",handleWiFiFormSubmit)}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",startConfigAutoRefresh):startConfigAutoRefresh();