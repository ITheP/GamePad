const responseDiv=document.getElementById("formResponse");function replacePlaceholders(html,dataMap){const result=[];let i=0;for(;i<html.length;)if("{"===html[i]){const endIdx=html.indexOf("}",i);if(-1!==endIdx){const placeholder=html.substring(i+1,endIdx);result.push(dataMap.hasOwnProperty(placeholder)?dataMap[placeholder]:html.substring(i,endIdx+1)),i=endIdx+1}else result.push(html[i]),i++}else result.push(html[i]),i++;return result.join("")}function loadHotspotContent(){fetch("/json/hotspot_info").then((response=>{if(!response.ok)throw new Error(`HTTP ${response.status}: ${response.statusText}`);return response.json()})).then((data=>{const contentDiv=document.getElementById("content"),processedHtml=replacePlaceholders(contentDiv.innerHTML,data);contentDiv.innerHTML=processedHtml;const ssidInput=document.getElementById("ssid"),passwordInput=document.getElementById("password");ssidInput&&void 0!==data.WiFiSSID&&(ssidInput.value=data.WiFiSSID),passwordInput&&void 0!==data.WiFiPassword&&(passwordInput.value=data.WiFiPassword)})).catch((error=>{responseDiv.innerHTML='<span style="color: red;"><strong>Error</strong> - Please check controller is powered on and is in Hotspot mode.</span>',console.error("Error fetching hotspot info:",error)}))}function updateAccessPoints(){fetch("/json/access_points").then((response=>{if(!response.ok)throw new Error(`HTTP ${response.status}: ${response.statusText}`);return response.json()})).then((data=>{const datalist=document.getElementById("ssidList");datalist.innerHTML="",data.accessPoints&&Array.isArray(data.accessPoints)&&data.accessPoints.forEach((ap=>{const option=document.createElement("option");option.value=ap.SSID,datalist.appendChild(option)}))})).catch((error=>{responseDiv.innerHTML='<span style="color: red;"><strong>Error</strong> - Please check controller is powered on and is in Hotspot mode.</span>',console.error("Error fetching access points:",error)}))}function updateWiFiStatus(){fetch("/json/wifi_status").then((response=>{if(!response.ok)throw new Error(`HTTP ${response.status}: ${response.statusText}`);return response.json()})).then((data=>{const statusSpan=document.getElementById("wifiStatus");data.Status&&(statusSpan.textContent=data.Status)})).catch((error=>{document.getElementById("wifiStatus").innerHTML='<span style="color: red;"><strong>Unable to fetch status.</strong></span>',responseDiv.innerHTML='<span style="color: red;"><strong>Error</strong> - Please check controller is powered on and is in Hotspot mode.</span>',console.error("Error fetching wifi status:",error)}))}function handleWiFiFormSubmit(event){event.preventDefault();const form=document.getElementById("wifiForm"),formData=new FormData(form);fetch("/api/UpdateWifiDetails",{method:"POST",body:formData}).then((response=>{if(!response.ok)throw new Error(`HTTP ${response.status}: ${response.statusText}`);return response.json()})).then((data=>{let message="";message=data.error?'<p style="color: red;"><strong>Error:</strong> '+escapeHtml(data.error)+"</p>":"ok"===data.status?'<p style="color: green;"><strong>Success:</strong> WiFi details saved</p>':'<p style="color: orange;"><strong>Response:</strong> '+escapeHtml(JSON.stringify(data))+"</p>",responseDiv.innerHTML=message})).catch((error=>{responseDiv.innerHTML='<p style="color: red;"><strong>Error:</strong> '+escapeHtml(error.message)+"</p>"}))}function escapeHtml(text){const div=document.createElement("div");return div.textContent=text,div.innerHTML}function startConfigAutoRefresh(){loadHotspotContent(),updateAccessPoints(),updateWiFiStatus(),IntervalManager.add((()=>{updateAccessPoints(),updateWiFiStatus()}),1e4);const form=document.getElementById("wifiForm");form&&form.addEventListener("submit",handleWiFiFormSubmit)}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",startConfigAutoRefresh):startConfigAutoRefresh();